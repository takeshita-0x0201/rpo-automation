{% extends "admin/_base_admin.html" %}

{% block title %}新規求人票の登録{% endblock %}

{% block admin_content %}
<div class="container mt-4">
    <h1 class="mb-4">新規求人票の登録</h1>

    {% if request.query_params.error == 'creation_failed' %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        求人票の作成に失敗しました。
        {% if request.query_params.message %}
        <br>詳細: {{ request.query_params.message }}
        {% endif %}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <div class="card">
        <div class="card-body">
            <form action="{{ base_path }}/job-postings/create" method="post" id="job-posting-form">
                <div class="alert alert-info mb-4">
                    <i class="bi bi-info-circle"></i> 求人票IDは自動的に割り当てられます（例: req-001）
                </div>
                
                <div class="mb-4">
                    <label for="position" class="form-label required">ポジション名</label>
                    <input type="text" class="form-control" id="position" name="position" 
                           placeholder="例: Treasury Specialist / トレジャリースペシャリスト" required>
                    <div class="form-text">正式な職種名を入力してください</div>
                </div>
                
                <div class="mb-4">
                    <label for="job_description" class="form-label required">求人票</label>
                    <textarea class="form-control" id="job_description" name="job_description" 
                              rows="20" placeholder="求人票の全文を貼り付けてください..." required></textarea>
                    <div class="form-text">
                        必要な情報：
                        <ul class="mb-0">
                            <li>業務内容</li>
                            <li>応募要件（必須スキル・歓迎スキル）</li>
                            <li>雇用形態・勤務地</li>
                            <li>その他の詳細情報</li>
                        </ul>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label for="memo" class="form-label">求人メモ（補足情報）</label>
                    <textarea class="form-control" id="memo" name="memo" rows="10" 
                              placeholder="ターゲット候補者、年収レンジ、選考のポイントなど..."></textarea>
                    <div class="form-text">
                        記載する情報の例：
                        <ul class="mb-0">
                            <li>募集背景・緊急度</li>
                            <li>ターゲット候補者像</li>
                            <li>年収レンジ（非公開の場合）</li>
                            <li>選考で重視するポイント</li>
                            <li>その他の注意事項</li>
                        </ul>
                    </div>
                </div>
                
                <hr class="my-4">
                
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> 登録
                        </button>
                        <a href="{{ base_path }}/job-postings" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> キャンセル
                        </a>
                    </div>
                    <div class="text-muted">
                        <small>登録後、この求人票を使用して採用要件を作成できます</small>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.required::after {
    content: " *";
    color: red;
}
</style>

<script>
// フォーム送信前の確認
document.getElementById('job-posting-form').addEventListener('submit', function(e) {
    const position = document.getElementById('position').value.trim();
    const jobDescription = document.getElementById('job_description').value.trim();
    
    if (!position || !jobDescription) {
        e.preventDefault();
        alert('ポジション名と求人票は必須項目です。');
        return false;
    }
    
    // 文字数チェック
    if (jobDescription.length < 100) {
        e.preventDefault();
        if (!confirm('求人票の内容が短いようです。このまま登録しますか？')) {
            return false;
        }
    }
});

// テキストエリアの自動リサイズ
function autoResize(textarea) {
    textarea.style.height = 'auto';
    textarea.style.height = textarea.scrollHeight + 'px';
}

document.getElementById('job_description').addEventListener('input', function() {
    autoResize(this);
});

document.getElementById('memo').addEventListener('input', function() {
    autoResize(this);
});
</script>
{% endblock %}