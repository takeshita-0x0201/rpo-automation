{% extends "common/_base.html" %}

{% block title %}候補者検索{% endblock %}

{% block content %}
<h1 class="mb-4">候補者検索</h1>

<form method="POST" action="/user/search/execute" id="searchForm">
    <div class="row">
        <div class="col-md-8">
            <!-- 基本検索条件 -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">基本検索条件</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="requirement_id" class="form-label">採用要件を選択 <span class="text-danger">*</span></label>
                        <select class="form-select" id="requirement_id" name="requirement_id" required onchange="loadRequirementDetails(this.value)">
                            <option value="">選択してください</option>
                            {% for req in requirements %}
                            <option value="{{ req.id }}" {% if req.id == selected_requirement_id %}selected{% endif %}>
                                {{ req.client_name }} - {{ req.position_name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="keywords" class="form-label">キーワード</label>
                        <input type="text" class="form-control" id="keywords" name="keywords" 
                               placeholder="例: Python, 機械学習, プロジェクトマネージャー">
                        <div class="form-text">スペース区切りで複数指定可能</div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <label for="location" class="form-label">勤務地</label>
                            <input type="text" class="form-control" id="location" name="location" 
                                   placeholder="例: 東京都">
                        </div>
                        <div class="col-md-6">
                            <label for="experience_years" class="form-label">経験年数</label>
                            <select class="form-select" id="experience_years" name="experience_years">
                                <option value="">指定なし</option>
                                <option value="0-3">0-3年</option>
                                <option value="3-5">3-5年</option>
                                <option value="5-10">5-10年</option>
                                <option value="10+">10年以上</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 詳細検索条件 -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <a class="text-decoration-none" data-bs-toggle="collapse" href="#advancedSearch">
                            詳細検索条件 <i class="bi bi-chevron-down"></i>
                        </a>
                    </h5>
                </div>
                <div class="collapse" id="advancedSearch">
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="must_have_skills" class="form-label">必須スキル</label>
                            <textarea class="form-control" id="must_have_skills" name="must_have_skills" rows="2"
                                      placeholder="例: Python, Django, AWS"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="nice_to_have_skills" class="form-label">歓迎スキル</label>
                            <textarea class="form-control" id="nice_to_have_skills" name="nice_to_have_skills" rows="2"
                                      placeholder="例: React, Docker, Kubernetes"></textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <label for="min_salary" class="form-label">年収下限（万円）</label>
                                <input type="number" class="form-control" id="min_salary" name="min_salary">
                            </div>
                            <div class="col-md-6">
                                <label for="max_salary" class="form-label">年収上限（万円）</label>
                                <input type="number" class="form-control" id="max_salary" name="max_salary">
                            </div>
                        </div>

                        <div class="mt-3">
                            <label class="form-label">業界経験</label>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="industries" value="IT" id="industry_it">
                                        <label class="form-check-label" for="industry_it">IT・インターネット</label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="industries" value="金融" id="industry_finance">
                                        <label class="form-check-label" for="industry_finance">金融</label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="industries" value="製造" id="industry_manufacturing">
                                        <label class="form-check-label" for="industry_manufacturing">製造業</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- サイドパネル -->
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">要件詳細</h5>
                </div>
                <div class="card-body" id="requirementDetails">
                    <p class="text-muted">採用要件を選択すると詳細が表示されます</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">検索オプション</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="max_results" class="form-label">最大取得件数</label>
                        <select class="form-select" id="max_results" name="max_results">
                            <option value="50">50件</option>
                            <option value="100" selected>100件</option>
                            <option value="200">200件</option>
                            <option value="500">500件</option>
                        </select>
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="exclude_contacted" name="exclude_contacted" checked>
                        <label class="form-check-label" for="exclude_contacted">
                            既にコンタクトした候補者を除外
                        </label>
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="active_only" name="active_only" checked>
                        <label class="form-check-label" for="active_only">
                            アクティブな候補者のみ
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-search"></i> 検索実行
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>

<script>
function loadRequirementDetails(requirementId) {
    if (!requirementId) {
        document.getElementById('requirementDetails').innerHTML = '<p class="text-muted">採用要件を選択すると詳細が表示されます</p>';
        return;
    }
    
    // TODO: APIから要件詳細を取得
    document.getElementById('requirementDetails').innerHTML = `
        <div class="spinner-border spinner-border-sm" role="status">
            <span class="visually-hidden">読み込み中...</span>
        </div>
        <span class="ms-2">読み込み中...</span>
    `;
}

document.getElementById('searchForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // 検索実行中の表示
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status"></span>検索中...';
    
    // フォーム送信
    this.submit();
});
</script>
{% endblock %}