# データベーステーブル一覧と使用状況

## 概要
このドキュメントは、RPO Automationシステムで定義されているSupabaseのテーブルと、その実際の使用状況をまとめたものです。

## テーブル分析SQLの実行方法

1. Supabase Dashboard の SQL Editor を開く
2. `database-audit.sql` の内容をコピー＆ペースト
3. 実行して結果を確認

## 現在定義されているテーブル

### 1. **profiles** (ユーザープロファイル)
- **目的**: ユーザー情報の管理
- **使用状況**: ✅ 使用中
- **主な用途**: 
  - ログイン認証後のユーザー情報表示
  - ロールベースアクセス制御（admin/manager/user）
- **関連機能**: ログイン、ユーザー管理画面

### 2. **clients** (クライアント企業)
- **目的**: クライアント企業情報の管理
- **使用状況**: ✅ 使用中
- **主な用途**:
  - クライアント一覧表示
  - ジョブ作成時のクライアント選択
  - 採用要件の紐付け
- **関連機能**: クライアント管理画面、ジョブ作成

### 3. **client_settings** (クライアント設定)
- **目的**: クライアント別のカスタム設定保存
- **使用状況**: ❌ 未使用
- **想定用途**: クライアント固有の設定（通知設定、カスタムフィールドなど）

### 4. **job_requirements** (採用要件)
- **目的**: 採用要件の詳細情報管理
- **使用状況**: ✅ 使用中
- **主な用途**:
  - 採用要件の作成・編集・一覧表示
  - AIによる構造化データの保存
  - ジョブ作成時の要件選択
- **関連機能**: 採用要件管理画面、ジョブ作成

### 5. **jobs** (ジョブ)
- **目的**: AIマッチングジョブの管理
- **使用状況**: ✅ 使用中（最新実装）
- **主な用途**:
  - ジョブの作成・実行・停止・削除
  - ステータス管理（pending/running/completed/failed）
  - 実行パラメータの保存
- **関連機能**: ジョブ管理画面

### 6. **search_jobs** (検索ジョブ)
- **目的**: 検索・スクレイピングジョブの管理
- **使用状況**: ❌ 未使用（jobsテーブルに統合）
- **備考**: docs/database-design.mdで定義されているが、実装ではjobsテーブルを使用

### 7. **job_status_history** (ジョブステータス履歴)
- **目的**: ジョブのステータス変更履歴
- **使用状況**: ❌ 未使用
- **想定用途**: ジョブの実行履歴とトラブルシューティング

### 8. **candidates** (候補者マスター)
- **目的**: 候補者の基本情報管理
- **使用状況**: ⚠️ 一部使用（Chrome拡張で使用予定）
- **想定用途**:
  - 重複候補者の管理
  - 候補者の基本情報保存

### 9. **candidate_submissions** (候補者データ提出履歴)
- **目的**: Chrome拡張機能からの候補者データ提出履歴
- **使用状況**: ❌ 未使用
- **想定用途**: データ収集の追跡とバージョン管理

### 10. **search_results** (検索結果)
- **目的**: AIマッチング結果の保存
- **使用状況**: ❌ 未使用
- **想定用途**: マッチング結果の表示と分析

### 11. **notification_settings** (通知設定)
- **目的**: ユーザー別の通知設定
- **使用状況**: ❌ 未使用
- **想定用途**: メール、Slack等の通知設定

### 12. **retry_queue** (リトライキュー)
- **目的**: 失敗した処理のリトライ管理
- **使用状況**: ❌ 未使用
- **想定用途**: API呼び出しやデータ処理の再試行

## 推奨事項

### 1. 使用中のテーブル
- profiles, clients, job_requirements, jobs は現在アクティブに使用されています
- これらのテーブルは現在の実装に必要不可欠です

### 2. 今後実装予定のテーブル
- candidates: Chrome拡張機能の実装時に使用開始
- search_results: AIマッチング機能の本格実装時に使用
- job_status_history: ジョブの詳細追跡が必要になった時点で実装

### 3. 統合・削除候補のテーブル
- search_jobs: jobsテーブルに統合済みのため削除可能
- client_settings: 具体的な要件が明確になるまで保留

### 4. 将来的に必要になる可能性があるテーブル
- notification_settings: 通知機能実装時
- retry_queue: バックグラウンド処理の信頼性向上時
- candidate_submissions: データ収集の監査証跡が必要な場合

## BigQueryとの連携

以下のデータはBigQueryに保存される想定：
- 大量の候補者スクレイピングデータ
- AIマッチングの詳細ログ
- 長期保存が必要な分析データ

Supabaseには以下を保存：
- マスターデータとメタデータ
- リアルタイムアクセスが必要なデータ
- トランザクション処理が必要なデータ